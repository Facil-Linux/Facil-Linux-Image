ARG KERNEL_FLAVOR="${KERNEL_FLAVOR:-fsync}"

FROM ghcr.io/ublue-os/bazzite:stable AS pwnlinux

COPY system_files/desktop/kinoite /
COPY system_files/desktop/shared /
COPY system_files/overrides /

# Remove uneeded packages
RUN mkdir -p /var/lib/alternatives && \
    rpm-ostree override remove pipewire-pulseaudio --install pulseaudio && \
    ostree container commit && \
    rpm-ostree override remove \
    ptyxis \
    discover-overlay \
    input-remapper \
    kde-connect-libs \
    kdeconnectd \
    kde-connect \
    kcharselect \
    krfb \
    krfb-libs \
    kmousetool \
    rom-properties-kf6 \
    protontricks \
    qsynth && \
    ostree container commit

# Install new packages
RUN rpm-ostree install \
    konsole \
    rust \
    pamixer \
    playerctl \
    cargo && \
    ostree container commit

# Remove uneeded files
RUN rm /usr/share/applications/com.gerbilsoft.rom-properties.rp-config.desktop && \
    ostree container commit

# Update the initramfs
RUN KERNEL_FLAVOR=fsync /usr/libexec/containerbuild/build-initramfs && \
    ostree container commit